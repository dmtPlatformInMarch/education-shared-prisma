// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  userId     String  @id @default(uuid()) // ì‚¬ìš©ì ê³ ìœ  ID
  mainUserId String  @unique
  email      String  @unique // ì‚¬ìš©ì ì´ë©”ì¼
  nickname   String? // ì‚¬ìš©ì ë‹‰ë„¤ì„
  name       String // ì‚¬ìš©ì ì´ë¦„

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  code     String? @unique // ì‚¬ìš©ì ì½”ë“œ (ì„ íƒ ì‚¬í•­)
  settings Json // ì‚¬ìš©ì ì„¤ì • (JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥)
  avatar   String? // ì‚¬ìš©ì ì•„ë°”íƒ€ ì´ë¯¸ì§€ URL

  role Role

  // ê´€ê³„
  organizations     UserToOrganization[] // ì‚¬ìš©ìê°€ ì†í•œ ì¡°ì§ ëª©ë¡
  classes           ClassToUser[] // ì‚¬ìš©ìê°€ ì†í•œ í´ë˜ìŠ¤ ëª©ë¡
  relations         UserRelation[]       @relation("UserRelationUser") // ì‚¬ìš©ì ê´€ê³„ ëª©ë¡ //ë¶€ëª¨
  targetRelations   UserRelation[]       @relation("UserRelationTargetUser") // ì‚¬ìš©ì ê´€ê³„ ëª©ë¡ //ìë…€
  posts             ClassPost[]
  postComments      ClassPostComment[] // ê²Œì‹œë¬¼ ëŒ“ê¸€ ëª©ë¡
  organizationPosts OrganizationPost[] // ì¡°ì§ ê²Œì‹œë¬¼ ëª©ë¡
  boards            Board[] // ì‚¬ìš©ìê°€ ì‘ì„±í•œ ê²Œì‹œíŒ ëª©ë¡
  createdClasses    Class[]
  schedules         SlotConfig[]
  // ğŸ‘‡ Define both roles for time slots
  teacherTimeSlots  TimeSlot[]           @relation("TeacherTimeSlots")
  clientTimeSlots   TimeSlot[]           @relation("ClientTimeSlots")
}

enum Role {
  STUDENT_CHILD //ì–´ë¦°ì´ í•™ìƒ íšŒì›
  STUDENT //ë§Œ 14ì„¸ ì´ìƒ
  TEACHER
  ADMIN
  PARENT
}

enum BoardPermission {
  OWNER //í´ë˜ìŠ¤ ì˜¤ë„ˆ
  TEACHER
  STUDENT
  PARENT
}

enum OrganizationType {
  KINDERGARDEN
  ELEMENTARY
  MIDDLE
  HIGH
  INSTITUTE //í•™ì› (êµê³¼,ì§„í•™ê´€ë ¨/ì–´í•™ì›/ì˜ˆëŠ¥í•™ì›/ê¸°íƒ€) ì„¸ë¶€í•­ëª© í•„ìš”í• ì§€?
}

model UserRelation {
  userRelationId String           @id @default(uuid()) // ì‚¬ìš©ì ê´€ê³„ ID
  userId         String // ì‚¬ìš©ì ID (ì£¼ì²´)
  targetUserId   String // ëŒ€ìƒ ì‚¬ìš©ì ID
  relationType   UserRelationType // ê´€ê³„ ìœ í˜• (ì˜ˆ: ë¶€ëª¨-ìì‹)

  createdAt DateTime           @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime           @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼
  status    UserRelationStatus

  user       User @relation(name: "UserRelationUser", fields: [userId], references: [userId]) // ê´€ê³„ ì£¼ì²´ ì‚¬ìš©ì
  targetUser User @relation(name: "UserRelationTargetUser", fields: [targetUserId], references: [userId]) // ê´€ê³„ ëŒ€ìƒ ì‚¬ìš©ì
}

enum UserRelationStatus {
  REQUESTED
  ACCEPTED
}

enum UserRelationType {
  PARENT_CHILD //user parent ,target ìœ ì•„, ì´ˆë“±
  PARENT_TEEN //user parent, target ì¤‘, ê³ ë“±í•™êµ
  //íŒ€ì¥-íŒ€ì› ë“±...
}

model Organization {
  organizationId String           @id @default(uuid()) // ì¡°ì§ ê³ ìœ  ID
  name           String // ì¡°ì§ ì´ë¦„
  code           String // ì¡°ì§ ì½”ë“œ
  autoApprove    Boolean          @default(false) // ìë™ ìŠ¹ì¸ ì—¬ë¶€
  visible        Boolean          @default(true) // ì¡°ì§ í‘œì‹œ ì—¬ë¶€
  type           OrganizationType

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼
  active    Boolean  @default(true) // í™œì„± ìƒíƒœ ì—¬ë¶€

  profile Json? // ì¡°ì§ í”„ë¡œí•„ ì •ë³´
  owner   String //ì¡°ì§ ìƒì„±ì ID

  classes           Class[] // ì¡°ì§ì— ì†í•œ í´ë˜ìŠ¤ ëª©ë¡
  userOrganizations UserToOrganization[] // ì‚¬ìš©ìì™€ ì¡°ì§ì˜ ê´€ê³„
}

model UserToOrganization {
  userOrganizationId String @id @default(uuid()) // ì‚¬ìš©ì-ì¡°ì§ ê´€ê³„ ID
  userId             String // ì‚¬ìš©ì ID
  user               User   @relation(fields: [userId], references: [userId]) // ì‚¬ìš©ì ê´€ê³„

  organizationId String // ì¡°ì§ ID
  organization   Organization @relation(fields: [organizationId], references: [organizationId]) // ì¡°ì§ ê´€ê³„

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼
}

model OrganizationSchedule {
  OrganizationScheduleId String   @id @default(uuid())
  isAllDay               Boolean
  startAt                DateTime //ex start_at
  endAt                  DateTime //ex end_at
  title                  String //ex name
  organizationId         String //ì¡°ì§ ì•„ì´ë””
}

model Class {
  classId        String       @id @default(uuid()) // í´ë˜ìŠ¤ ê³ ìœ  ID
  organizationId String // ì¡°ì§ ID
  organization   Organization @relation(fields: [organizationId], references: [organizationId]) // ì¡°ì§ ê´€ê³„

  code        String  @default(uuid()) // í´ë˜ìŠ¤ ì½”ë“œ
  title       String // í´ë˜ìŠ¤ ì œëª©
  description String? // í´ë˜ìŠ¤ ì„¤ëª…
  visible     Boolean @default(true) // í´ë˜ìŠ¤ í‘œì‹œ ì—¬ë¶€
  autoApprove Boolean @default(false) // ìë™ ìŠ¹ì¸ ì—¬ë¶€

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  ownerId    String
  owner      User          @relation(fields: [ownerId], references: [mainUserId]) // í´ë˜ìŠ¤ ì†Œìœ ì (êµì‚¬) ê´€ê³„
  classUsers ClassToUser[] // í´ë˜ìŠ¤ì— ì†í•œ ì‚¬ìš©ì ëª©ë¡
  boards     Board[] // í´ë˜ìŠ¤ì— ì†í•œ ê²Œì‹œíŒ ëª©ë¡
}

model ClassToUser {
  classUserId String @id @default(uuid()) // í´ë˜ìŠ¤-ì‚¬ìš©ì ê´€ê³„ ID
  classId     String // í´ë˜ìŠ¤ ID
  class       Class  @relation(fields: [classId], references: [classId]) // í´ë˜ìŠ¤ ê´€ê³„

  userId String // ì‚¬ìš©ì ID
  user   User   @relation(fields: [userId], references: [mainUserId]) // ì‚¬ìš©ì ê´€ê³„

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼
  active    Boolean  @default(true) // ìŠ¹ì¸ì—¬ë¶€ ì¶”í›„ í•„ìš” ê°€ëŠ¥ì„±
}

model Board {
  boardId     String            @id @default(uuid()) // ê²Œì‹œíŒ ê³ ìœ  ID
  boardType   String // ê²Œì‹œíŒ ìœ í˜• (ì˜ˆ: ê³µì§€ì‚¬í•­, ììœ ê²Œì‹œíŒ ë“±)
  classId     String // í´ë˜ìŠ¤ ID
  class       Class             @relation(fields: [classId], references: [classId]) // í´ë˜ìŠ¤ì™€ì˜ ê´€ê³„
  title       String // ê²Œì‹œíŒ ì œëª©
  description String? // ê²Œì‹œíŒ ì„¤ëª…
  permissions BoardPermission[] // ê²Œì‹œíŒ ì ‘ê·¼ ê¶Œí•œ ì •ë³´ (JSON í˜•ì‹ìœ¼ë¡œ ì €ì¥)

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  ownerId String // ê²Œì‹œíŒ ì†Œìœ ì ID
  owner   User        @relation(fields: [ownerId], references: [mainUserId])
  posts   ClassPost[] // ê²Œì‹œíŒì— ì‘ì„±ëœ ê²Œì‹œë¬¼ ëª©ë¡

  organizationId String // ì¡°ì§ ID
}

model ClassPost {
  postId  String @id @default(uuid()) // ê²Œì‹œë¬¼ ê³ ìœ  ID
  boardId String // ê²Œì‹œíŒ ID
  board   Board  @relation(fields: [boardId], references: [boardId]) // ê²Œì‹œíŒê³¼ì˜ ê´€ê³„

  title    String // ê²Œì‹œë¬¼ ì œëª©
  content  String // ê²Œì‹œë¬¼ ë‚´ìš©
  file     String?
  fileName String?

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  writerId String // ì‘ì„±ì ID
  writer   User   @relation(fields: [writerId], references: [mainUserId]) // ì‘ì„±ìì™€ì˜ ê´€ê³„

  comments ClassPostComment[] // ê²Œì‹œë¬¼ ëŒ“ê¸€ ëª©ë¡

  classId        String
  organizationId String // ì¡°ì§ ID
}

model ClassPostComment {
  commentId String    @id @default(uuid()) // ëŒ“ê¸€ ê³ ìœ  ID
  postId    String // ê²Œì‹œë¬¼ ID
  post      ClassPost @relation(fields: [postId], references: [postId]) // ê²Œì‹œë¬¼ê³¼ì˜ ê´€ê³„

  content String // ëŒ“ê¸€ ë‚´ìš©

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  writerId String // ì‘ì„±ì ID
  writer   User   @relation(fields: [writerId], references: [mainUserId]) // ì‘ì„±ìì™€ì˜ ê´€ê³„
}

model OrganizationPost {
  postId         String @id @default(uuid()) // ê²Œì‹œë¬¼ ê³ ìœ  ID
  organizationId String // ì¡°ì§ ID

  title    String // ê²Œì‹œë¬¼ ì œëª©
  content  String // ê²Œì‹œë¬¼ ë‚´ìš©
  file     String?
  fileName String?

  createdAt DateTime @default(now()) @db.Timestamptz(6) // ìƒì„±ì¼
  updatedAt DateTime @default(now()) @db.Timestamptz(6) // ìˆ˜ì •ì¼

  writerId String // ì‘ì„±ì ID
  writer   User   @relation(fields: [writerId], references: [mainUserId]) // ì‘ì„±ìì™€ì˜ ê´€ê³„
}

model SlotConfig {
  slotConfigId String     @id @default(uuid()) // 
  teacherId    String // ìƒë‹´ì ID
  teacher      User       @relation(fields: [teacherId], references: [mainUserId]) // ìƒë‹´ìì™€ì˜ ê´€ê³„
  startTime    String // ì‹œì‘ ì‹œê°„
  endTime      String // ì¢…ë£Œ ì‹œê°„
  recurring    Int        @default(1) // ìš”ì¼ ë°˜ë³µ ê¸°ê°„ ì„¤ì •
  TimeSlots    TimeSlot[]
}

model TimeSlot {
  requestId    String     @id @default(uuid()) // ìš”ì²­ ID
  slotConfigId String //ì‹œê°„ ì„¤ì • ID
  slotConfig   SlotConfig @relation(fields: [slotConfigId], references: [slotConfigId])

  startTime String // ìŠ¬ë¡¯ ì‹œì‘ ì‹œê°„
  endTime   String // ìŠ¬ë¡¯ ì¢…ë£Œ ì‹œê°„
  date      DateTime // ğŸŸ¢ The actual date (e.g. 2025-07-15)

  teacherId String
  teacher   User   @relation("TeacherTimeSlots", fields: [teacherId], references: [mainUserId])

  clientId String
  client   User   @relation("ClientTimeSlots", fields: [clientId], references: [mainUserId])

  status    SlotRequestStatus // ìš”ì²­ ìƒíƒœ
  createdAt DateTime          @default(now())
  updatedAt DateTime          @default(now())
}

enum SlotRequestStatus {
  CLOSED //ìš”ì²­ ê±°ë¶€ì¤‘ ìƒíƒœ
  PENDING // ëŒ€ê¸°ì¤‘
  APPROVED // ìƒë‹´ìê°€ ìš”ì²­ì„ ìŠ¹ì¸í•œ ìƒíƒœ
  DECLINED // ìƒë‹´ìê°€ ìš”ì²­ì„ ê±°ì ˆí•œ ìƒíƒœ
  CANCELED // ë‚´ë‹´ìê°€ ìš”ì²­ì„ ì·¨ì†Œí•œ ìƒíƒœ
  COMPLETED // ìƒë‹´ ì™„ë£Œ ìƒíƒœ
}

// 
